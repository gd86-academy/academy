<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" dir="ltr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>주소록</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
    .dataTable-top {
        display: flex;
        justify-content: flex-start;
        align-items: center;
    }
    .dataTable-search {
        margin-right: auto;
    }
</style>
<link rel="icon" type="image/x-icon" th:href="@{/favicon.png}" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap"
	rel="stylesheet" />

<!-- Stylesheets -->
<link rel="stylesheet" type="text/css" media="screen"
	th:href="@{/css/perfect-scrollbar.min.css}" />
<link rel="stylesheet" type="text/css" media="screen"
	th:href="@{/css/style.css}" />
<link defer rel="stylesheet" type="text/css" media="screen"
	th:href="@{/css/animate.css}" />
<link rel="stylesheet" th:href="@{/css/highlight.min.css}" />
<link rel="stylesheet" th:href="@{/css/flatpickr.min.css}" />
<link rel="stylesheet" th:href="@{/css/nouislider.min.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/css/nice-select2.css}" />
<link rel="stylesheet" th:href="@{/css/templete.css}" />

<!-- Scripts -->
<script th:src="@{/js/perfect-scrollbar.min.js}"></script>
<script defer th:src="@{/js/popper.min.js}"></script>
<script th:src="@{/js/alpine-collaspe.min.js}"></script>
<script th:src="@{/js/alpine-persist.min.js}"></script>
<script defer th:src="@{/js/alpine-ui.min.js}"></script>
<script defer th:src="@{/js/alpine-focus.min.js}"></script>
<script defer th:src="@{/js/alpine.min.js}"></script>
<script th:src="@{/js/custom.js}"></script>
<script th:src="@{/js/flatpickr.js}"></script>
<script th:src="@{/js/nouislider.min.js}"></script>
<script th:src="@{/js/highlight.min.js}"></script>
<script defer th:src="@{/js/tippy-bundle.umd.min.js}"></script>
<script defer th:src="@{/js/sweetalert.min.js}"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script
	src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script defer th:src="@{/js/address.js}"></script>
<script th:src="@{/js/nice-select2.js}"></script>
<script th:src="@{/js/simple-datatables.js}"></script>
<style>
/* 기본 커서 설정 */
table.whitespace-nowrap tbody tr {
	cursor: pointer; /* 행에 커서 올리면 포인터로 변경 */
}

/* 행을 클릭했을 때 스타일 */
table.whitespace-nowrap tbody tr.selected {
	background-color: #d1ecf1; /* 클릭된 행 색상 */
}

/* 마우스를 올렸을 때 스타일 */
table.whitespace-nowrap tbody tr:hover {
	background-color: #f1f1f1; /* 마우스를 올렸을 때 색상 */
}
</style>
</head>

<body x-data="main"
	class="relative overflow-x-hidden font-nunito text-sm font-normal antialiased"
	:class="[ $store.app.sidebar ? 'toggle-sidebar' : '', $store.app.theme === 'dark' || $store.app.isDarkMode ?  'dark' : '', $store.app.menu, $store.app.layout,$store.app.rtlClass]">
	<!-- sidebar menu overlay -->
	<div x-cloak class="fixed inset-0 z-50 bg-[black]/60 lg:hidden"
		:class="{'hidden' : !$store.app.sidebar}"
		@click="$store.app.toggleSidebar()"></div>

	<!-- 화면로딩 UI -->
	<div
		class="screen_loader animate__animated fixed inset-0 z-[60] grid place-content-center bg-[#fafafa] dark:bg-[#060818]">
		<span class="w-5 h-5 m-auto mb-10"><span
			class="animate-ping inline-flex h-full w-full rounded-full bg-info"></span></span>
	</div>

	<!-- 최상단 이동 버튼 -->
	<div class="fixed bottom-6 z-50 ltr:right-6 rtl:left-6"
		x-data="scrollToTop">
		<template x-if="showTopButton">
			<button type="button"
				class="btn btn-outline-primary animate-pulse rounded-full bg-[#fafafa] p-2 dark:bg-[#060818] dark:hover:bg-primary"
				@click="goToTop">
				<svg width="24" height="24" class="h-4 w-4" viewBox="0 0 24 24"
					fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path opacity="0.5" fill-rule="evenodd"
						clip-rule="evenodd"
						d="M12 20.75C12.4142 20.75 12.75 20.4142 12.75 20L12.75 10.75L11.25 10.75L11.25 20C11.25 20.4142 11.5858 20.75 12 20.75Z"
						fill="currentColor" />
                        <path
						d="M6.00002 10.75C5.69667 10.75 5.4232 10.5673 5.30711 10.287C5.19103 10.0068 5.25519 9.68417 5.46969 9.46967L11.4697 3.46967C11.6103 3.32902 11.8011 3.25 12 3.25C12.1989 3.25 12.3897 3.32902 12.5304 3.46967L18.5304 9.46967C18.7449 9.68417 18.809 10.0068 18.6929 10.287C18.5768 10.5673 18.3034 10.75 18 10.75L6.00002 10.75Z"
						fill="currentColor" />
                    </svg>
			</button>
		</template>
	</div>

	<div
		class="main-container min-h-screen text-black dark:text-white-dark"
		:class="[$store.app.navbar]">
		<!-- 사이드바 파일 연결 -->
		<div th:replace="fragments/sidebar :: sidebar"></div>
		<!-- end sidebar section -->

		<div class="main-content flex min-h-screen flex-col">
			<!-- 헤더 파일 연결 -->
			<div th:replace="fragments/header :: header"></div>

			<!-- 메인화면 -->
			<div class="animate__animated p-6 " :class="[$store.app.animation]">

				<div class="dvanimation animate__animated p-6"
					:class="[$store.app.animation]">
					<!-- start main content section -->
					<div x-data="chat" x-init="initChat()">
						<div
							class="relative flex h-full gap-5 sm:h-[calc(100vh_-_150px)] sm:min-h-0"
							:class="{'min-h-[999px]' : isShowChatMenu}">
							
							<!-- Http -->
							<div
								class="panel absolute z-10 hidden w-full max-w-xs flex-none space-y-4 overflow-hidden p-4 xl:relative xl:block xl:h-full"
								:class="isShowChatMenu && '!block'">

								<!--채팅방 리스트 창 (왼쪽 사이드)-->
								<div
									class="h-px w-full border-b border-[#e0e6ed] dark:border-[#1b2e4b]"></div> <!-- 채팅 패널의 섹션을 나누는 수평선 -->
								<div class="!mt-0">
								<div class="chat-users perfect-scrollbar relative -mr-3.5 h-full min-h-[100px] space-y-0.5 pr-3.5 sm:h-[calc(100vh_-_357px)]">
						<!-- 채팅 사용자 목록을 담는 컨테이너  -->
										<div x-init="initMulticolumn">
												<div class="panel">
													<table id="chatUserTable" class="whitespace-nowrap"></table><!-- 줄바꿈없이 사용자 목록을  표시하는 테이블 요소 -->
												</div>
											</div>
									</div><!-- 사용자 목록에 대한 컨테이너의 끝 -->
								</div><!-- 채팅 패널 끝 -->

							</div>

							<div
								class="absolute z-[5] hidden h-full w-full rounded-md bg-black/60"
								:class="isShowChatMenu && '!block xl:!hidden'"
								@click="isShowChatMenu = !isShowChatMenu"></div>
							<div class="panel flex-1 p-0">
								<template x-if="!isShowUserChat"> <!-- 채팅 패널이 보이지 않을 때 렌더링 -->
									<div
										class="relative flex h-full items-center justify-center p-4"> <!-- 패널 내의 중앙에 배치된 div -->
										<p>채팅할 사용자를 선택하세요</p>
									</div>
								</template> <!-- isShowUserChat 패널 끝 -->
								<!--채팅창 -->
								<template x-if="isShowUserChat && selectedUser"> <!-- isShowUserChat이 true이고 selectedUser가 사용가능한 경우 렌더링 -->
									<div class="relative h-full">
										<div class="flex items-center justify-between p-4">
											<div class="flex items-center space-x-2 rtl:space-x-reverse">
												<button type="button" class="hover:text-primary xl:hidden"
													@click="isShowChatMenu = !isShowChatMenu"> <!-- 채팅 메뉴 표시 여부를 전환하는 버튼 -->
												</button> <!-- 토글 버튼 끝 -->
												<div class="relative flex-none"> <!-- 선택된 사용자 프로필 이미지를 위한 컨테이너 -->
													<img
														class="h-9 w-9 rounded-full object-cover saturate-50 group-hover:saturate-100"
														:src="selectedUserImage || './images/defaultProfile.png'"
														:alt="selectedUser || 'Default profile'">
													<div class="absolute bottom-0 ltr:right-0 rtl:left-0"> <!-- 사용자의 온라인 상태를 보여주는 아바타 하단의 작은 표시기 -->
														<div class="h-4 w-4 rounded-full bg-success"></div>
													</div> <!-- 사용자 프로필 컨테이너 끝 -->
												</div>
												<div class="mx-3">
													<p class="font-semibold" x-text="selectedUser"></p> <!-- 선택된 사용자의 이름을 표시하는 굵은 글씨의 문장 -->
												</div>
									
											</div>

										</div>
										<div
											class="h-px w-full border-b border-[#e0e6ed] dark:border-[#1b2e4b]"></div> <!-- 헤더와 채팅 메시지를 나누는 수평선 -->
										<div
											class="perfect-scrollbar relative h-full overflow-auto sm:h-[calc(100vh_-_300px)]"> <!-- 스크롤 할 수 있는 영역이 있는 채팅 메시지를 위한 컨테이너 -->
											<div
												class="chat-conversation-box min-h-[400px] space-y-5 p-4 pb-[68px] sm:min-h-[300px] sm:pb-0">  <!-- 작은 화면에 맞는 패딩과 최소 높이가 적용된 채팅 메시지 상자 -->
												<div class="m-6 mt-0 block"> 
													<h4
														class="relative border-b border-[#f4f4f4] text-center text-xs dark:border-gray-800">
														<span
															class="relative top-2 bg-white px-3 dark:bg-[#0e1726]"
															x-text="'Today, ' + new Date().toLocaleTimeString()"></span>
													</h4>   <!-- 오늘의 날짜와 시간을 표시하는 동적 텍스트가 포함된 채팅 메시지의 날짜에 대한 헤더 -->
												</div>
												<template x-for="message in messages" :key="message.id">  <!-- 선택된 사용자의 메시지를 렌더링하는 Alpine.js루프 -->
													<div class="flex items-start gap-3"
														:class="{'justify-end' : currentUserName === message.fromUserName}">
														<div class="flex-none"
															:class="{'order-2' : currentUserName === message.fromUserName}">  <!-- 각 메시지에 대한 div는 메시지를 보낸 사람에 따라 조건부 정렬을 적용함 -->
															<template
																x-if="currentUserName === message.fromUserName">
																
															</template>
															<template
																x-if="selectedUser.userId !== message.fromUserId">
																<img :src="currentUserName === message.fromUserName ? currentUserImage : selectedUser.path"
																	class="h-10 w-10 rounded-full object-cover" />
															</template>   <!-- 로그인 사용자나 선택한 사용자의 아바타를 표시하기 위한 조건부 렌더링이다. -->
														</div>
														<div class="space-y-2"> <!--메시지와 타임스탬프를 위한 div -->
															<div class="flex items-center gap-3">  <!-- 메시지와 옵션(이모티콘)을 위한 플렉스 컨테이너이다. -->
																<div
																	class="rounded-md bg-black/10 p-4 py-2 dark:bg-gray-800"
																	:class="currentUserName === message.fromUserName ? 'ltr:rounded-br-none rtl:rounded-bl-none !bg-primary text-white' : 'ltr:rounded-bl-none rtl:rounded-br-none'"
																	x-text="message.content"></div>  <!-- 발신자 ID에 따라 동적 스타일이 적용된 메시지 버블이다. -->
																
															</div>
															<div class="text-xs text-white-dark"   
																:class="{'ltr:text-right rtl:text-left' : currentUserName === message.fromUserName}"
																x-text="new Date(message.create_date).toLocaleTimeString()"></div>
														</div> <!-- 발신자 ID를 기준으로 조건부 정렬이 적용된 메시지 타임스탬프이다. -->
													</div>
												</template>
											</div>  <!-- chat-conversation-box 끝 -->
										</div>  <!-- 스크롤 영역의 끝 -->
										<!--채팅창 메시지 입력창 -->   
										<div class="absolute bottom-0 left-0 w-full p-4"> <!-- 채팅창 하단의 메시지 입력을 위한 컨테이너 -->
											<div
												class="w-full items-center space-x-3 rtl:space-x-reverse sm:flex"> <!-- 입력 영역을 위한 flex 컨테이너 -->
												<div class="relative flex-1"> <!-- 메시지 입력을 위한 유연한 컨테이너 -->
													<input
														class="form-input rounded-full border-0 bg-[#f4f4f4] px-12 py-2 focus:outline-none"
														placeholder="Type a message" x-model="textMessage"
														@keyup.enter="sendMessage()" />   <!-- 사용자가 메시지를 입력할 수 있는 입력 필드와, "Enter"키를 눌러 메시지를 보낼 수 있는 이벤트 핸들러가 있다. -->
													<!--메시지 입력 왼쪽 아이콘-->
													<button type="button"
														class="absolute top-1/2 -translate-y-1/2 hover:text-primary ltr:left-4 rtl:right-4">
														<svg width="24" height="24" viewBox="0 0 24 24"
															fill="none" xmlns="http://www.w3.org/2000/svg"
															class="h-5 w-5">
														<circle
																opacity="0.5" cx="12" cy="12" r="10"
																stroke="currentColor" stroke-width="1.5" />
														<path
																d="M9 16C9.85038 16.6303 10.8846 17 12 17C13.1154 17 14.1496 16.6303 15 16"
																stroke="currentColor" stroke-width="1.5"
																stroke-linecap="round" />
														<path
																d="M16 10.5C16 11.3284 15.5523 12 15 12C14.4477 12 14 11.3284 14 10.5C14 9.67157 14.4477 9 15 9C15.5523 9 16 9.67157 16 10.5Z"
																fill="currentColor" />
														<ellipse
																cx="9" cy="10.5" rx="1" ry="1.5" fill="currentColor" />
													</svg>
													</button>
													<!-- 메시지 입력창 (오른쪽 아이콘)-->
													<button type="button"
														class="absolute top-1/2 -translate-y-1/2 hover:text-primary ltr:right-4 rtl:left-4"
														@click="sendMessage()">
							<!-- 메시지 전송 버튼(비행기) --><svg width="24" height="24" viewBox="0 0 24 24"   
															fill="none" xmlns="http://www.w3.org/2000/svg"
															class="h-5 w-5">
														<path
																d="M17.4975 18.4851L20.6281 9.09373C21.8764 5.34874 22.5006 3.47624 21.5122 2.48782C20.5237 1.49939 18.6511 2.12356 14.906 3.37189L5.57477 6.48218C3.49295 7.1761 2.45203 7.52305 2.13608 8.28637C2.06182 8.46577 2.01692 8.65596 2.00311 8.84963C1.94433 9.67365 2.72018 10.4495 4.27188 12.0011L4.55451 12.2837C4.80921 12.5384 4.93655 12.6658 5.03282 12.8075C5.22269 13.0871 5.33046 13.4143 5.34393 13.7519C5.35076 13.9232 5.32403 14.1013 5.27057 14.4574C5.07488 15.7612 4.97703 16.4131 5.0923 16.9147C5.32205 17.9146 6.09599 18.6995 7.09257 18.9433C7.59255 19.0656 8.24576 18.977 9.5522 18.7997L9.62363 18.79C9.99191 18.74 10.1761 18.715 10.3529 18.7257C10.6738 18.745 10.9838 18.8496 11.251 19.0285C11.3981 19.1271 11.5295 19.2585 11.7923 19.5213L12.0436 19.7725C13.5539 21.2828 14.309 22.0379 15.1101 21.9985C15.3309 21.9877 15.5479 21.9365 15.7503 21.8474C16.4844 21.5244 16.8221 20.5113 17.4975 18.4851Z"
																stroke="currentColor" stroke-width="1.5" />
														<path
																opacity="0.5" d="M6 18L21 3" stroke="currentColor"
																stroke-width="1.5" stroke-linecap="round" />
													</svg>
													</button>
												</div>
												<div
													class="hidden items-center space-x-3 py-3 rtl:space-x-reverse sm:block sm:py-0">

												</div>
											</div>
										</div>
									</div>
								</template>
							</div>
						</div>
					</div>
					<!-- end main content section -->
				</div>
			</div>


			<!--  풋터 파일 연결 -->
			<div th:replace="fragments/footer :: footer"></div>
		</div>
	</div>
	<script th:src="@{/customjs/employeeList.js}"></script>
	<script th:src="@{/customjs/chat.js}"></script>
</body>
</html>
