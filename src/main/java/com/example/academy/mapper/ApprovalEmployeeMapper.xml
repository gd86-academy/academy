<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.academy.mapper.ApprovalEmployeeMapper">
	<!-- 김혜린 : 근태신청서 상세페이지 - 결재자 목록 -->
	<select id="approverList" parameterType="Integer" resultType="com.example.academy.dto.AttendanceApprovalOneDTO">
		SELECT 
			ae.attendance_approval_no attendanceApprovalNo
			, ae.approver approver
			, e.employee_name employeeName
			, e.employee_department employeeDepartmentCode
			, c1.`name` employeeDepartment
			, ae.approval_level approvalLevel
			, ae.approval_employee_status approvalEmployeeStatusCode
			, c2.`name` approvalEmployeeStatus
			, f.file_name fileName
			, f.file_ext fileExt
		FROM approval_employee ae LEFT OUTER JOIN employee e
		ON ae.approver = e.employee_no
		LEFT OUTER JOIN common c1
		ON e.employee_department = c1.`code`
		LEFT OUTER JOIN common c2
		ON ae.approval_employee_status = c2.`code`
		LEFT OUTER JOIN file f
		ON e.stamp_file_no = f.file_no
		WHERE ae.attendance_approval_no = #{attendanceApprovalNo}
	</select>

	<!-- 김혜린 : 근태신청서 결재자 추가 -->
	<insert id="insertAttendanceApprovalEmployee" parameterType="com.example.academy.dto.AttendanceApprovalAddDTO" useGeneratedKeys="true" keyProperty="attendanceApprovalNo">
		INSERT INTO approval_employee(
			attendance_approval_no
			, approver
			, approval_level
			)
		VALUES (
			#{attendanceApprovalNo}
			, #{approver}
			, #{approvalLevel}
			)
	</insert>
</mapper>