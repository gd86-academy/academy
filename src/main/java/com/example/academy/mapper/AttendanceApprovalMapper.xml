<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.academy.mapper.AttendanceApprovalMapper">
	
	<!-- 김혜린 : 근태신청서 수정 -->
	<update id="updateAttendanceApproval" parameterType="com.example.academy.dto.AttendanceApprovalModifyDTO">
		UPDATE attendance_approval
		SET
		   attendance_approval_type = #{attendanceApprovalType}
		   , attendance_approval_begindate = #{attendanceApprovalBeginDate}
		   , attendance_approval_enddate = #{attendanceApprovalEndDate}
		   , attendance_approval_title = #{attendanceApprovalTitle}
		   , attendance_approval_content = #{attendanceApprovalContent}
		WHERE attendance_approval_no = #{attendanceApprovalNo}
	</update>
	
	<!-- 김혜린 : 근태신청서 상세페이지 -->
	<select id="selectAttendanceApprovalOne" parameterType="Integer" resultType="com.example.academy.dto.AttendanceApprovalOneDTO">
		SELECT 
			ap.attendance_approval_no attendanceApprovalNo
			, ap.employee_no employeeNo
			, e.employee_name employeeName
			, ap.attendance_approval_type attendanceApprovalType
			, ap.update_date updateDate
			, ap.attendance_approval_begindate attendanceApprovalBeginDate
			, ap.attendance_approval_enddate attendanceApprovalEndDate
			, ap.attendance_approval_title attendanceApprovalTitle
			, ap.attendance_approval_content attendanceApprovalContent
			, ap.attendance_approval_step attendanceApprovalStep
			, c1.`name` attendanceApprovalStatus
		FROM attendance_approval ap LEFT OUTER JOIN employee e
		ON ap.employee_no = e.employee_no
		LEFT OUTER JOIN common c1
		ON ap.attendance_approval_status = c1.`code`
		WHERE ap.attendance_approval_no = #{attendanceApprovalNo}
	</select>
	
	<!-- 김혜린 : 근태신청서 신청 -->
	<insert id="insertAttendanceApproval" parameterType="com.example.academy.dto.AttendanceApprovalAddDTO" useGeneratedKeys="true" keyProperty="attendanceApprovalNo">
		INSERT INTO attendance_approval(
			employee_no
			, attendance_approval_title
			, attendance_approval_content
			, attendance_approval_begindate
			, attendance_approval_enddate
			, attendance_approval_type
			)
		VALUES (
			#{employeeNo}
			, #{attendanceApprovalTitle}
			, #{attendanceApprovalContent}
			, #{attendanceApprovalBeginDate}
			, #{attendanceApprovalEndDate}
			, #{attendanceApprovalType}
			)
	</insert>
	
	<!-- 김혜린 : 결재 대기 목록 - 근태신청서 조회 -->
	<select id="selectWaitAttendanceAprrovalList" parameterType="Integer" resultType="com.example.academy.dto.AttendanceApprovalListDTO">
		SELECT 
			aa.attendance_approval_no attendanceApprovalNo
			, aa.attendance_approval_title attendanceApprovalTitle
			, aa.attendance_approval_type attendanceApprovalTypeCode
			, c1.`name` attendanceApprovalType
			, aa.employee_no employeeNo
			, e.employee_name employeeName
			, aa.attendance_approval_status attendanceApprovalStatusCode 
			, c2.`name` attendanceApprovalStatus
			, ae.approver approver
			, aa.attendance_approval_step attendanceApprovalStep
			, ae.approval_level approvalLevel
		FROM attendance_approval aa LEFT OUTER JOIN employee e
		ON aa.employee_no = e.employee_no
		LEFT OUTER JOIN common c1
		ON aa.attendance_approval_type = c1.`code`
		LEFT OUTER JOIN common c2
		ON aa.attendance_approval_status = c2.`code`
		LEFT OUTER JOIN approval_employee ae
		ON ae.attendance_approval_no = aa.attendance_approval_no
		WHERE aa.use_yn = 1
		AND ae.approver = #{employeeNo}
		AND aa.attendance_approval_status = 'AS001'
		AND aa.attendance_approval_step = ae.approval_level
	</select>
	
	<!-- 김혜린 : 나의 신청 목록 - 근태신청서리스트 조회 -->
	<select id="selectAttendanceAprrovalList" parameterType="Integer" resultType="com.example.academy.dto.AttendanceApprovalListDTO">
		SELECT 
			aa.attendance_approval_no attendanceApprovalNo
			, aa.attendance_approval_title attendanceApprovalTitle
			, aa.attendance_approval_type attendanceApprovalTypeCode
			, c1.`name` attendanceApprovalType
			, aa.employee_no employeeNo
			, e.employee_name employeeName
			, aa.attendance_approval_status attendanceApprovalStatusCode
			, c2.`name` attendanceApprovalStatus
		FROM attendance_approval aa LEFT OUTER JOIN employee e
		ON aa.employee_no = e.employee_no 
		LEFT OUTER JOIN common c1
		ON aa.attendance_approval_type = c1.code
		LEFT OUTER JOIN common c2
		ON aa.attendance_approval_status = c2.code
		WHERE aa.use_yn = 1
		AND aa.employee_no = #{employeeNo}
		ORDER BY aa.update_date DESC
	</select>
	
</mapper>